<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è´§å¸ä¸Šå¸ç›‘æ§ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            margin-bottom: 30px;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { opacity: 0.8; }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .card h2 { margin-bottom: 15px; font-size: 1.5em; }
        .server-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .server-item {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid transparent;
        }
        .server-item.online { border-left-color: #00ff88; }
        .server-item.offline { border-left-color: #ff4444; }
        .server-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .server-ip { opacity: 0.8; font-size: 0.9em; }
        .server-status {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .status-online { background: #00ff88; color: #000; }
        .status-offline { background: #ff4444; color: #fff; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .stat-box {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label { opacity: 0.8; }
        .exchange-bar {
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .recent-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #00ff88;
        }
        .recent-title { font-weight: bold; margin-bottom: 5px; }
        .recent-meta { font-size: 0.85em; opacity: 0.7; }
        .loading { text-align: center; padding: 40px; opacity: 0.6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ åŠ å¯†è´§å¸ä¸Šå¸ç›‘æ§ç³»ç»Ÿ</h1>
            <p>å®æ—¶ç›‘æ§ 5 å°æœåŠ¡å™¨ | 4 ä¸ªäº¤æ˜“æ‰€</p>
        </div>

        <div class="card">
            <h2>ğŸ“Š ä»Šæ—¥ç»Ÿè®¡</h2>
            <div class="stats-grid" id="stats-grid">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ–¥ï¸ æœåŠ¡å™¨çŠ¶æ€</h2>
            <div class="server-grid" id="server-grid">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“ˆ äº¤æ˜“æ‰€ç»Ÿè®¡</h2>
            <div id="exchange-stats">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ”” æœ€è¿‘å‘ç°</h2>
            <div id="recent-listings">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        function updateDashboard() {
            fetch('/api/status')
                .then(res => res.json())
                .then(data => {
                    const grid = document.getElementById('server-grid');
                    grid.innerHTML = '';
                    
                    for (const [serverId, info] of Object.entries(data)) {
                        const div = document.createElement('div');
                        div.className = `server-item ${info.online ? 'online' : 'offline'}`;
                        div.innerHTML = `
                            <div class="server-name">${serverId.toUpperCase()}</div>
                            <div class="server-ip">${info.ip}</div>
                            <div class="server-status">
                                <span class="status-badge ${info.online ? 'status-online' : 'status-offline'}">
                                    ${info.online ? 'ğŸŸ¢ åœ¨çº¿' : 'ğŸ”´ ç¦»çº¿'}
                                </span>
                                <span>${info.last_heartbeat < 999 ? info.last_heartbeat + 'ç§’å‰' : '---'}</span>
                            </div>
                            <div class="server-status">
                                <span>æ‰«æ: ${info.scan_count}</span>
                                <span>å‘ç°: ${info.found_count}</span>
                            </div>
                        `;
                        grid.appendChild(div);
                    }
                });

            fetch('/api/stats')
                .then(res => res.json())
                .then(data => {
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    document.getElementById('total-scans').textContent = data.total_scans || 0;
                    document.getElementById('total-found').textContent = data.total_found || 0;
                    
                    // æ›´æ–°æœ€è¿‘å‘ç°
                    const recentDiv = document.getElementById('recent-listings');
                    if (data.recent_listings && data.recent_listings.length > 0) {
                        recentDiv.innerHTML = data.recent_listings.map(item => `
                            <div class="listing-item" style="padding: 12px; margin-bottom: 10px; background: white; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #333; margin-bottom: 5px;">
                                            ${item.exchange}
                                        </div>
                                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">
                                            ${item.title}
                                        </div>
                                        ${item.symbols && item.symbols.length > 0 ? `
                                            <div style="margin-top: 5px;">
                                                ${item.symbols.map(s => `<span style="display: inline-block; padding: 2px 8px; background: #e3f2fd; color: #1976d2; border-radius: 4px; font-size: 12px; margin-right: 5px;">${s}</span>`).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div style="text-align: right; font-size: 12px; color: #999;">
                                        ${new Date(item.timestamp).toLocaleString('zh-CN', {month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'})}
                                    </div>
                                </div>
                                ${item.url ? `<a href="${item.url}" target="_blank" style="display: inline-block; margin-top: 8px; color: #1976d2; font-size: 13px; text-decoration: none;">ğŸ”— æŸ¥çœ‹è¯¦æƒ…</a>` : ''}
                            </div>
                        `).join('');
                    } else {
                        recentDiv.innerHTML = '<div class="loading">æš‚æ— æ–°ä¸Šå¸å‘ç°</div>';
                    }
                    const statsGrid = document.getElementById('stats-grid');
                    statsGrid.innerHTML = `
                        <div class="stat-box">
                            <div class="stat-label">æ€»æ‰«ææ¬¡æ•°</div>
                            <div class="stat-number">${data.total_scans.toLocaleString()}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">å‘ç°æ–°å…¬å‘Š</div>
                            <div class="stat-number">${data.total_found}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">æ¨é€æˆåŠŸç‡</div>
                            <div class="stat-number">100%</div>
                        </div>
                    `;

                    const exchangeStats = document.getElementById('exchange-stats');
                    exchangeStats.innerHTML = '';
                    for (const [exchange, count] of Object.entries(data.exchange_stats)) {
                        const div = document.createElement('div');
                        div.className = 'exchange-bar';
                        div.innerHTML = `
                            <span><strong>${exchange}</strong></span>
                            <span>${count} ä¸ªæ–°å…¬å‘Š</span>
                        `;
                        exchangeStats.appendChild(div);
                    }

                    const recentListings = document.getElementById('recent-listings');
                    if (data.recent_listings && data.recent_listings.length > 0) {
                        recentListings.innerHTML = '';
                        data.recent_listings.forEach(item => {
                            const div = document.createElement('div');
                            div.className = 'recent-item';
                            div.innerHTML = `
                                <div class="recent-title">${item.title}</div>
                                <div class="recent-meta">
                                    ${item.exchange} | ${new Date(item.timestamp).toLocaleString('zh-CN')}
                                </div>
                            `;
                            recentListings.appendChild(div);
                        });
                    } else {
                        recentListings.innerHTML = '<p style="opacity:0.6;text-align:center;padding:20px;">æš‚æ— æ–°å‘ç°</p>';
                    }
                });
        }

        updateDashboard();
        setInterval(updateDashboard, 5000);
    </script>
</body>
</html>
