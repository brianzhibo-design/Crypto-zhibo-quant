<!DOCTYPE html>
<html lang="en" class="antialiased dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fusion Monitor v9.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Inter:wght@300;400;500;600&family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Rajdhani', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #000; color: #e2e8f0; overflow-x: hidden; }
        .ambient-blob { position: fixed; border-radius: 50%; filter: blur(80px); opacity: 0.5; z-index: -2; animation: blob 20s infinite alternate; }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #3b0764; }
        .blob-2 { bottom: -20%; right: -10%; width: 60vw; height: 60vw; background: #0c4a6e; animation-delay: 5s; }
        @keyframes blob { 0% { transform: translate(0,0) scale(1); } 50% { transform: translate(30px,-50px) scale(1.1); } 100% { transform: translate(0,0) scale(1); } }
        .phantom-card { background: rgba(15,15,20,0.3); backdrop-filter: blur(24px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.06); box-shadow: 0 8px 32px rgba(0,0,0,0.4); transition: all 0.3s; }
        .phantom-card:hover { background: rgba(25,25,35,0.4); border-color: rgba(255,255,255,0.15); transform: translateY(-2px); }
        .glow-text-cyan { text-shadow: 0 0 20px rgba(34,211,238,0.6); }
        .glow-text-violet { text-shadow: 0 0 20px rgba(139,92,246,0.6); }
        .hero-text { background: linear-gradient(135deg,#fff,#cbd5e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .tab-btn { position: relative; font-family: 'Rajdhani',sans-serif; letter-spacing: 0.05em; text-transform: uppercase; font-weight: 700; color: #64748b; transition: all 0.3s; }
        .tab-btn:hover { color: #e2e8f0; }
        .tab-active { color: #22d3ee; }
        .tab-active::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 2px; background: #22d3ee; box-shadow: 0 0 10px #22d3ee; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        .list-row { transition: background 0.2s; }
        .list-row:hover { background: rgba(255,255,255,0.03); }
        dialog::backdrop { background: rgba(0,0,0,0.8); backdrop-filter: blur(12px); }
        dialog[open] { animation: zoomIn 0.3s ease-out; }
        @keyframes zoomIn { from { opacity:0; transform:scale(0.95); } to { opacity:1; transform:scale(1); } }
    </style>
</head>
<body class="flex flex-col min-h-screen text-white">
    <div class="ambient-blob blob-1"></div>
    <div class="ambient-blob blob-2"></div>

    <header class="fixed top-6 left-0 right-0 z-50 px-6 flex justify-between items-center pointer-events-none">
        <div class="phantom-card px-6 py-3 pointer-events-auto flex items-center gap-4">
            <div class="relative w-8 h-8 flex items-center justify-center">
                <div class="absolute inset-0 bg-cyan-500 rounded-full blur-lg opacity-40 animate-pulse"></div>
                <div class="relative bg-black rounded-full w-full h-full flex items-center justify-center border border-cyan-500/30">
                    <div class="w-3 h-3 bg-cyan-400 rounded-full"></div>
                </div>
            </div>
            <div>
                <h1 class="font-display font-bold text-xl tracking-wider hero-text">QUANTUM <span class="text-cyan-400">FLUID</span></h1>
                <p class="text-[9px] font-mono text-cyan-200/40 tracking-[0.3em] uppercase">Monitor v9.5</p>
            </div>
        </div>
        <div class="phantom-card px-2 py-2 pointer-events-auto hidden lg:flex gap-6">
            <button onclick="switchTab('dashboard')" id="tab-dashboard" class="tab-btn px-4 py-1 tab-active">Dashboard</button>
            <button onclick="switchTab('analytics')" id="tab-analytics" class="tab-btn px-4 py-1">Analytics</button>
            <button onclick="switchTab('alerts')" id="tab-alerts" class="tab-btn px-4 py-1">Alerts</button>
        </div>
        <div class="phantom-card px-6 py-3 pointer-events-auto text-right hidden md:block">
            <div id="clock" class="font-display text-2xl font-bold text-white tracking-widest">00:00:00</div>
            <div class="text-[9px] font-mono text-emerald-400/80 tracking-widest mt-1 flex justify-end items-center gap-2">
                <span class="w-1 h-1 bg-emerald-400 rounded-full animate-pulse"></span> ONLINE
            </div>
        </div>
    </header>

    <main class="flex-1 pt-32 px-6 pb-12 w-full max-w-[1920px] mx-auto z-10 relative">
        <div id="panel-dashboard" class="tab-panel grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-3 flex flex-col gap-6">
                <div class="phantom-card p-5 border-l-2 border-l-violet-500">
                    <h3 class="font-display text-sm text-violet-300 uppercase tracking-widest mb-2">AI Neural Insight</h3>
                    <p id="ai-summary" class="text-xs text-white leading-relaxed font-mono">Initializing...</p>
                    <div class="mt-3 text-[9px] text-gray-300 font-mono text-right" id="ai-timestamp">--:--</div>
                </div>
                <div class="phantom-card p-6">
                    <span class="font-display text-xs text-gray-300 uppercase tracking-widest">Stream Velocity</span>
                    <div class="mt-2 flex items-baseline gap-2">
                        <span id="stat-processed" class="font-display text-4xl font-bold text-white glow-text-cyan">--</span>
                        <span class="font-mono text-[10px] text-cyan-500">EPS</span>
                    </div>
                </div>
                <div class="phantom-card p-6">
                    <span class="font-display text-xs text-gray-300 uppercase tracking-widest">Fusion Events</span>
                    <div class="mt-2 flex items-baseline gap-2">
                        <span id="stat-fused" class="font-display text-4xl font-bold text-white glow-text-violet">--</span>
                        <span class="font-mono text-[10px] text-violet-500">HITS</span>
                    </div>
                </div>
                <div class="phantom-card p-5 flex-1 min-h-[200px]">
                    <div class="flex justify-between items-center mb-4">
                        <span class="font-display text-xs text-gray-300 uppercase tracking-widest">Cluster Nodes</span>
                        <span id="stat-nodes-count" class="font-mono text-[10px] bg-black/40 px-2 py-0.5 rounded text-white">--</span>
                    </div>
                    <div id="nodes-grid" class="grid grid-cols-1 gap-2 overflow-y-auto max-h-[300px] custom-scrollbar"></div>
                </div>
            </div>
            <div class="col-span-12 lg:col-span-6 flex flex-col gap-6">
                <div class="phantom-card h-[320px] relative p-1">
                    <div class="absolute top-4 left-6 z-10">
                        <h2 class="font-display text-base text-white tracking-widest uppercase">Throughput <span class="text-cyan-500">::</span> Realtime</h2>
                    </div>
                    <div class="w-full h-full rounded-2xl overflow-hidden bg-black/20 relative">
                        <canvas id="fusionChart" class="relative z-10"></canvas>
                    </div>
                </div>
                <div class="phantom-card flex-1 min-h-[400px] flex flex-col overflow-hidden">
                    <div class="px-6 py-3 border-b border-white/5 flex justify-between items-center bg-black/40">
                        <div class="flex items-center gap-3">
                            <div class="w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse"></div>
                            <h3 class="font-display text-sm font-bold text-white uppercase tracking-widest">Live Stream</h3>
                        </div>
                    </div>
                    <div id="events-container" class="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar"></div>
                </div>
            </div>
            <div class="col-span-12 lg:col-span-3 flex flex-col gap-6">
                <div class="phantom-card flex-1 min-h-[400px] flex flex-col overflow-hidden">
                    <div class="px-5 py-3 border-b border-white/5 flex justify-between items-center bg-violet-500/5">
                        <h3 class="font-display text-sm font-bold text-white uppercase tracking-widest glow-text-violet">Alpha Signals</h3>
                        <span class="text-[9px] font-mono text-violet-300 bg-violet-500/10 px-2 rounded border border-violet-500/20">HIGH PRIORITY</span>
                    </div>
                    <div id="super-events-container" class="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar"></div>
                </div>
                <div class="phantom-card p-5 h-[300px] flex flex-col">
                    <h3 class="font-display text-xs text-gray-300 uppercase tracking-widest mb-4">Exchange Dominance</h3>
                    <div id="exchange-rank-list" class="flex-1 overflow-y-auto space-y-1 custom-scrollbar"></div>
                </div>
            </div>
        </div>
        <div id="panel-analytics" class="tab-panel hidden grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="phantom-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-display text-lg text-white uppercase tracking-widest">Alpha Rankings</h3>
                    <select id="alpha-range" onchange="updateAlphaRanking()" class="bg-black/30 border border-white/10 rounded px-2 py-1 text-xs font-mono text-cyan-400">
                        <option value="1h">1 HOUR</option>
                        <option value="6h">6 HOURS</option>
                        <option value="24h">24 HOURS</option>
                    </select>
                </div>
                <div id="alpha-ranking" class="space-y-2 overflow-y-auto max-h-[600px] custom-scrollbar"></div>
            </div>
            <div class="phantom-card p-6">
                <h3 class="font-display text-lg text-white uppercase tracking-widest mb-6">Exchange Latency</h3>
                <div id="exchange-leadlag" class="space-y-2"></div>
            </div>
        </div>
        <div id="panel-alerts" class="tab-panel hidden grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="phantom-card p-6">
                <h3 class="font-display text-lg text-white uppercase tracking-widest mb-6">Configure Logic</h3>
                <div class="space-y-4">
                    <input type="text" id="rule-name" placeholder="RULE NAME" class="w-full bg-black/30 border border-white/10 rounded px-4 py-3 text-sm font-mono text-white outline-none">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" id="rule-min-sources" value="2" class="bg-black/30 border border-white/10 rounded px-4 py-3 text-sm font-mono text-white">
                        <input type="number" id="rule-min-score" value="35" class="bg-black/30 border border-white/10 rounded px-4 py-3 text-sm font-mono text-white">
                    </div>
                    <div class="flex gap-3">
                        <button onclick="testRule()" class="flex-1 py-3 border border-white/20 text-white font-display font-bold text-sm rounded hover:bg-black/40">TEST</button>
                        <button onclick="createRule()" class="flex-1 py-3 bg-cyan-600/20 border border-cyan-500/50 text-cyan-300 font-display font-bold text-sm rounded hover:bg-cyan-600/30">DEPLOY</button>
                    </div>
                    <div id="rule-test-results" class="hidden p-4 bg-black/40 rounded border border-white/5 text-xs font-mono text-gray-200"></div>
                </div>
            </div>
            <div class="phantom-card p-6">
                <h3 class="font-display text-lg text-white uppercase tracking-widest mb-6">Active Protocols</h3>
                <div id="active-rules" class="space-y-3"></div>
            </div>
        </div>
    </main>

    <dialog id="detail-modal" class="bg-transparent p-0 w-full max-w-3xl m-auto">
        <div class="phantom-card !bg-[#0a0a10]/95 overflow-hidden shadow-2xl border border-cyan-500/30">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-400 via-violet-500 to-fuchsia-500"></div>
            <div class="p-8">
                <div class="flex justify-between items-start mb-6 border-b border-white/5 pb-6">
                    <div>
                        <h2 id="modal-title" class="font-display text-3xl font-bold text-white glow-text-cyan">--</h2>
                        <div class="text-xs font-mono text-cyan-200/50 mt-1"><span id="modal-ts">---</span> | <span id="modal-id">---</span></div>
                    </div>
                    <div id="modal-score" class="font-display text-5xl font-bold text-white glow-text-violet">0</div>
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-display text-xs text-gray-300 uppercase mb-3">Sources</h4>
                        <div id="modal-sources" class="space-y-2"></div>
                    </div>
                    <div>
                        <h4 class="font-display text-xs text-gray-300 uppercase mb-3">Payload</h4>
                        <div class="bg-black/40 rounded p-3 max-h-[200px] overflow-auto custom-scrollbar">
                            <pre id="modal-raw" class="text-[10px] font-mono text-cyan-100/70 whitespace-pre-wrap"></pre>
                        </div>
                        <button onclick="document.getElementById('detail-modal').close()" class="mt-4 w-full py-2 bg-black/40 border border-white/10 text-white font-display text-xs rounded hover:bg-black/50">CLOSE</button>
                    </div>
                </div>
            </div>
        </div>
    </dialog>

    <script>
        window.eventCache = new Map();
        const num = n => new Intl.NumberFormat().format(n || 0);

        function switchTab(tabId) {
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
            document.getElementById('panel-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active', 'text-cyan-400'));
            document.getElementById('tab-' + tabId).classList.add('tab-active', 'text-cyan-400');
            if (tabId === 'analytics') loadAnalytics();
            if (tabId === 'alerts') loadAlertRules();
        }

        const ctx = document.getElementById('fusionChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(34, 211, 238, 0.4)');
        gradient.addColorStop(1, 'rgba(34, 211, 238, 0)');
        const fusionChart = new Chart(ctx, {
            type: 'line',
            data: { labels: Array(40).fill(''), datasets: [{ data: Array(40).fill(0), borderColor: '#22d3ee', borderWidth: 2, backgroundColor: gradient, fill: true, tension: 0.5, pointRadius: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false, min: 0 } }, animation: { duration: 0 } }
        });

        async function fetchAPI(url) {
            try { const r = await fetch(url); if (r.ok) return await r.json(); } catch (e) { console.error(e); }
            return null;
        }

        async function updateDashboard() {
            const stats = await fetchAPI('/api/stats');
            if (stats) {
                document.getElementById('stat-processed').innerText = num(stats.processed);
                document.getElementById('stat-fused').innerText = num(stats.fused);
                const arr = fusionChart.data.datasets[0].data;
                if (!window.lastFused) window.lastFused = stats.fused;
                let delta = Math.max(0, stats.fused - window.lastFused);
                if (delta === 0 && Math.random() > 0.7) delta = Math.random() * 3;
                window.lastFused = stats.fused;
                arr.shift(); arr.push(delta);
                fusionChart.update('none');
            }

            const ai = await fetchAPI('/api/analytics/ai-insight');
            if (ai) {
                document.getElementById('ai-summary').innerText = ai.summary;
                document.getElementById('ai-timestamp').innerText = new Date(ai.generated_at).toLocaleTimeString();
            }

            const events = await fetchAPI('/api/events/latest');
            if (Array.isArray(events)) {
                events.forEach(e => window.eventCache.set(e.id, e));
                document.getElementById('events-container').innerHTML = events.map(e => 
                    '<div class="list-row flex items-center justify-between py-2 px-3 rounded cursor-pointer border-l-2 border-transparent hover:border-cyan-400" onclick="openEventById(\'' + e.id + '\')">' +
                    '<div class="flex items-center gap-3"><div class="font-mono text-xs font-bold text-white">' + e.symbols + '</div><div class="text-[9px] text-gray-300 uppercase font-mono">' + e.source + '</div></div>' +
                    '<div class="flex items-center gap-3"><div class="text-[10px] font-mono text-gray-300">' + new Date(parseInt(e.ts)).toLocaleTimeString([], {hour12: false}) + '</div><div class="font-display font-bold text-gray-200">' + parseFloat(e.score).toFixed(0) + '</div></div></div>'
                ).join('');
            }

            const supers = await fetchAPI('/api/events/super');
            if (Array.isArray(supers)) {
                supers.forEach(e => window.eventCache.set(e.id, e));
                document.getElementById('super-events-container').innerHTML = supers.map(e => {
                    const score = parseFloat(e.score);
                    const isHigh = score > 80;
                    return '<div class="p-3 rounded bg-black/40 hover:bg-violet-500/10 cursor-pointer border border-white/5 hover:border-violet-500/30" onclick="openEventById(\'' + e.id + '\')">' +
                        '<div class="flex justify-between items-center"><div><div class="flex items-center gap-2"><span class="font-display font-bold text-sm text-gray-200">' + e.symbols + '</span><span class="text-[9px] px-1.5 rounded font-mono ' + (isHigh ? 'bg-violet-500 text-white' : 'bg-slate-800 text-gray-300') + '">' + e.source_count + ' SRC</span></div><div class="text-[9px] text-gray-300 mt-1 font-mono">' + e.exchange + '</div></div>' +
                        '<div class="text-xl font-display font-bold ' + (isHigh ? 'text-violet-300 glow-text-violet' : 'text-gray-300') + '">' + score.toFixed(0) + '</div></div></div>';
                }).join('');
            }

            const status = await fetchAPI('/api/status');
            if (status && status.nodes) {
                const nodes = Object.entries(status.nodes);
                document.getElementById('stat-nodes-count').innerText = nodes.length;
                document.getElementById('nodes-grid').innerHTML = nodes.map(([k, v]) =>
                    '<div class="flex justify-between items-center p-2 rounded bg-black/40 hover:bg-black/50"><div class="flex items-center gap-2"><div class="w-1.5 h-1.5 rounded-full ' + (v.status === 'online' ? 'bg-emerald-400' : 'bg-red-500') + '"></div><span class="text-[10px] font-mono text-gray-200">' + k + '</span></div><span class="text-[10px] font-mono text-gray-300">' + num(v.processed) + '</span></div>'
                ).join('');
            }

            const ranks = await fetchAPI('/api/analytics/exchange-ranking');
            if (Array.isArray(ranks)) {
                document.getElementById('exchange-rank-list').innerHTML = ranks.map((r, i) =>
                    '<div class="flex items-center justify-between p-2 hover:bg-black/40 rounded"><div class="flex items-center gap-3"><span class="text-[10px] font-mono text-gray-300">0' + (i + 1) + '</span><span class="text-xs font-bold text-white w-16 font-display uppercase">' + r.name + '</span><div class="w-16 h-0.5 bg-slate-800 rounded-full overflow-hidden"><div class="h-full bg-cyan-500" style="width:' + r.super_rate + '%"></div></div></div><span class="text-[10px] font-mono text-cyan-600">' + r.super_rate + '%</span></div>'
                ).join('');
            }
        }

        async function loadAnalytics() {
            updateAlphaRanking();
            const leadlag = await fetchAPI('/api/analytics/exchange-leadlag');
            if (leadlag && leadlag.rankings) {
                document.getElementById('exchange-leadlag').innerHTML = leadlag.rankings.slice(0, 5).map(ex =>
                    '<div class="flex justify-between items-center p-3 bg-black/40 rounded border border-white/5"><span class="font-display font-bold text-white">' + (ex.exchange || 'N/A').toUpperCase() + '</span><div class="text-xs text-emerald-400 font-mono">' + (ex.first_rate || 0) + '% FIRST</div></div>'
                ).join('');
            }
        }

        async function updateAlphaRanking() {
            const range = document.getElementById('alpha-range').value;
            const data = await fetchAPI('/api/analytics/alpha-ranking?limit=10&range=' + range);
            if (data && Array.isArray(data.rankings)) {
                data.rankings.forEach(e => window.eventCache.set(e.id, e));
                document.getElementById('alpha-ranking').innerHTML = data.rankings.map((evt, i) =>
                    '<div class="flex items-center justify-between p-3 bg-black/40 rounded border border-white/5 hover:border-cyan-500/30 cursor-pointer" onclick="openEventById(\'' + evt.id + '\')"><div class="flex items-center gap-4"><div class="text-xl font-display font-bold text-gray-300 w-6">0' + (i + 1) + '</div><div><div class="font-mono font-bold text-white">' + evt.symbols + '</div><div class="text-[9px] text-gray-300 uppercase">' + evt.exchange + ' â€¢ ' + evt.time_ago + '</div></div></div><div class="font-display font-bold text-xl text-cyan-400">' + evt.score + '</div></div>'
                ).join('');
            }
        }

        async function loadAlertRules() {
            const rules = await fetchAPI('/api/alerts/rules');
            if (Array.isArray(rules)) {
                document.getElementById('active-rules').innerHTML = rules.map(r =>
                    '<div class="flex justify-between items-center p-3 bg-black/40 rounded border border-white/5"><div><div class="font-bold text-white text-sm">' + r.name + '</div><div class="text-[10px] text-gray-300 font-mono">MIN_SRC:' + r.conditions.min_source_count + '</div></div><button onclick="deleteRule(\'' + r.id + '\')" class="text-[10px] text-rose-400 hover:text-rose-300">DEL</button></div>'
                ).join('');
            }
        }

        async function createRule() {
            const rule = { name: document.getElementById('rule-name').value, conditions: { min_source_count: parseInt(document.getElementById('rule-min-sources').value), min_score: parseInt(document.getElementById('rule-min-score').value) }, actions: [{ type: 'log' }] };
            await fetch('/api/alerts/rules', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(rule) });
            loadAlertRules();
        }

        async function deleteRule(id) {
            await fetch('/api/alerts/rules/' + id, { method: 'DELETE' });
            loadAlertRules();
        }

        async function testRule() {
            const rule = { conditions: { min_source_count: parseInt(document.getElementById('rule-min-sources').value), min_score: parseInt(document.getElementById('rule-min-score').value) } };
            const res = await fetch('/api/alerts/test', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(rule) });
            const data = await res.json();
            document.getElementById('rule-test-results').classList.remove('hidden');
            document.getElementById('rule-test-results').innerHTML = data.matches ? 'MATCHES: ' + data.matches.length : 'No matches';
        }

        window.openEventById = id => { const e = window.eventCache.get(id); if (e) openModal(e); };

        window.openModal = e => {
            document.getElementById('modal-title').innerText = e.symbols;
            document.getElementById('modal-score').innerText = parseFloat(e.score).toFixed(0);
            document.getElementById('modal-ts').innerText = new Date(parseInt(e.ts)).toLocaleString();
            document.getElementById('modal-id').innerText = e.id;
            document.getElementById('modal-raw').innerText = e.raw_text || 'No Data';
            const srcs = (e.source || '').split(',');
            const exchs = (e.exchange || '').split(',');
            document.getElementById('modal-sources').innerHTML = srcs.map((s, i) =>
                '<div class="flex justify-between p-2 rounded bg-black/40 border border-white/10"><span class="text-xs text-cyan-200 font-mono">' + (exchs[i] || 'UNK') + '</span><span class="text-[10px] text-gray-200 uppercase">' + s + '</span></div>'
            ).join('');
            document.getElementById('detail-modal').showModal();
        };

        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', { hour12: false }); }, 1000);

        let isUpdating = false;
        async function loopDashboard() {
            if (!isUpdating) {
                isUpdating = true;
                try { await updateDashboard(); } catch (e) { console.error(e); }
                isUpdating = false;
            }
            setTimeout(loopDashboard, 2000);
        }
        loopDashboard();
    </script>
</body>
</html>

