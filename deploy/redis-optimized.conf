# Redis 优化配置 - 4核8G 单机部署
# 内存限制为 2GB，留足空间给 Python 进程

# ============================================================
# 网络
# ============================================================
bind 127.0.0.1
port 6379
protected-mode yes

# ============================================================
# 内存管理 (关键优化)
# ============================================================
# 最大内存 2GB
maxmemory 2gb

# 内存淘汰策略 - 优先删除最近最少使用的 key
maxmemory-policy allkeys-lru

# 内存采样数
maxmemory-samples 5

# ============================================================
# Stream 优化
# ============================================================
# Stream 内存限制 - 自动裁剪
# 通过 XTRIM 命令手动管理

# ============================================================
# 持久化 (可选，按需启用)
# ============================================================
# RDB 快照 - 每5分钟1000次写入
# save 300 1000

# 禁用 AOF (减少 IO)
appendonly no

# ============================================================
# 性能优化
# ============================================================
# TCP keepalive
tcp-keepalive 300

# 客户端超时
timeout 300

# 最大客户端连接数
maxclients 100

# ============================================================
# 后台任务
# ============================================================
# 惰性删除
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# ============================================================
# 日志
# ============================================================
loglevel notice
logfile "/var/log/redis/redis.log"

# ============================================================
# 安全
# ============================================================
# 设置密码（从环境变量配置）
# requirepass your_password_here

